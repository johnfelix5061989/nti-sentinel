<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suporte NTI - CIODS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #13293D;
            --bg-surface: #006494;
            --accent-1: #247BA0;
            --accent-bright: #1B98E0;
            --text-light: #E8F1F2;
        }
        
        body { 
            background-color: var(--bg-deep); 
            color: var(--text-light); 
            font-family: 'Segoe UI', sans-serif; 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh; 
        }

        /* BOT√ÉO HOME (NOVO) */
        .btn-home {
            position: absolute;
            top: 15px;
            left: 15px;
            text-decoration: none;
            color: var(--accent-bright);
            border: 1px solid var(--accent-bright);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            z-index: 1000;
            background: rgba(19, 41, 61, 0.8);
        }
        .btn-home:hover {
            background-color: var(--accent-bright);
            color: var(--bg-deep);
            box-shadow: 0 0 10px var(--accent-bright);
        }
        
        .chat-container { 
            max-width: 500px; 
            margin: 60px auto 40px auto; 
            background: var(--bg-surface); 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid var(--accent-1);
        }
        
        .bot-msg { background: var(--accent-1); padding: 12px; border-radius: 15px 15px 15px 0; margin-bottom: 10px; width: fit-content; color: white; }
        .user-msg { background: var(--accent-bright); color: var(--bg-deep); padding: 12px; border-radius: 15px 15px 0 15px; margin-bottom: 10px; margin-left: auto; width: fit-content; font-weight: 700; }
        
        /* Bot√µes Padr√£o */
        .btn-outline-custom { color: var(--text-light); border-color: var(--accent-bright); margin-bottom: 5px; }
        .btn-outline-custom:hover { background-color: var(--accent-bright); color: var(--bg-deep); }
        
        /* Bot√£o DESTAQUE (N√£o Encontrei) */
        .btn-nao-encontrei {
            background-color: #c0392b;
            color: white;
            border: none;
            font-weight: bold;
            margin-top: 15px;
            padding: 12px;
            box-shadow: 0 4px 10px rgba(192, 57, 43, 0.4);
            transition: transform 0.2s;
        }
        .btn-nao-encontrei:hover {
            background-color: #e74c3c;
            transform: scale(1.02);
            color: white;
        }
        
        /* Inputs do Formul√°rio */
        .form-control { background-color: var(--bg-deep); border: 1px solid var(--accent-1); color: var(--text-light); }
        .form-control:focus { background-color: var(--bg-deep); color: white; border-color: var(--accent-bright); box-shadow: none; }
        .form-control::placeholder { color: #8faab9; }

        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        footer {
            margin-top: auto; 
            text-align: center; 
            padding: 20px; 
            font-size: 0.85rem; 
            color: var(--text-light); 
            opacity: 0.6; 
            border-top: 1px solid rgba(255,255,255,0.05); 
        }
    </style>
</head>
<body>

    <a href="home.html" class="btn-home">üè† Home</a>

<div class="container">
    <div class="chat-container fade-in">
        <div class="text-center mb-3">
            <h5 style="color: var(--accent-bright)">ü§ñ NTI - CIODS</h5>
            <small class="text-light opacity-75">Autoatendimento Inteligente</small>
        </div>

        <div id="chat-box" style="height:350px; overflow-y:auto; padding-right: 5px;">
            <div class="bot-msg">Ol√°! Qual o problema que voc√™ est√° enfrentando?</div>
        </div>

        <div id="opcoes" class="d-grid gap-2 mt-3">
            <button class="btn btn-outline-custom" onclick="conversa('internet')">üì∂ Sem Internet (cabo)</button>
            <button class="btn btn-outline-custom" onclick="conversa('wifi')">üì° Wi-Fi</button>
            <button class="btn btn-outline-custom" onclick="conversa('impressora')">üñ®Ô∏è Impressora</button>
            <button class="btn btn-outline-custom" onclick="conversa('monitor')">üñ•Ô∏è Monitor</button>
            <button class="btn btn-outline-custom" onclick="conversa('periferico')">‚å®Ô∏è Mouse / Teclado</button>
            <button class="btn btn-outline-custom" onclick="conversa('energia')">üîå Energia / Tomada</button>
            <button class="btn btn-outline-custom" onclick="conversa('lento')">üê¢ Computador Lento</button>
            <button class="btn btn-outline-custom" onclick="conversa('sistema')">üñ•Ô∏è Sistema Institucional</button>
            <button class="btn btn-outline-custom" onclick="conversa('senha')">üîë Senha / Acesso</button>
            <button class="btn btn-outline-custom" onclick="conversa('telaazul')">‚ö†Ô∏è Tela Azul</button>
            <button class="btn btn-outline-custom" onclick="conversa('audio')">üîà Sem Som</button>
            <button class="btn btn-outline-custom" onclick="conversa('arquivo')">üìÑ Arquivo n√£o abre</button>
            <button class="btn btn-outline-custom" onclick="conversa('desliga')">üîÑ PC desliga sozinho</button>
            
            <button class="btn btn-outline-secondary mt-2" onclick="mostrarFormulario('Outros')">üìù Outro Problema (do NTI)</button>

            <button class="btn btn-nao-encontrei" onclick="window.location.href='externo.html'">
                üö® N√ÉO ENCONTREI MEU PROBLEMA
            </button>
        </div>

        <div id="form-chamado" class="hidden mt-3 fade-in">
            <h6 class="text-info mb-3">Abrir Chamado T√©cnico</h6>
            
            <div class="row mb-2">
                <div class="col-8">
                    <input type="text" id="nome" class="form-control" placeholder="Nome Completo">
                </div>
                <div class="col-4">
                    <input type="number" id="matricula" class="form-control" placeholder="Matr√≠cula">
                </div>
            </div>

            <input type="text" id="setor" class="form-control mb-2" placeholder="Seu Setor">
            <input type="hidden" id="assunto-pre" value="">
            <textarea id="desc" class="form-control mb-2" rows="2" placeholder="Descreva detalhes..."></textarea>
            
            <div class="d-flex gap-2">
                <button class="btn btn-secondary w-50" onclick="cancelar()">Voltar</button>
                <button class="btn btn-primary w-50" style="background: var(--accent-bright); border: none;" onclick="enviarChamado()">üöÄ Enviar</button>
            </div>
        </div>
    </div>
</div>

<footer>
    <strong>Desenvolvido por</strong> Jo√£o Douglas Brito de S√° <strong>F√©lix</strong> 2026
</footer>

<script>
const box = document.getElementById('chat-box');
const opcoes = document.getElementById('opcoes');
const form = document.getElementById('form-chamado');
let menuPrincipalHTML = "";

// Salva o menu original assim que a p√°gina carrega
window.onload = function() {
    menuPrincipalHTML = opcoes.innerHTML;
}

function addUser(msg){
    box.innerHTML += `<div class="user-msg fade-in">${msg}</div>`;
}

function addBot(msg){
    box.innerHTML += `<div class="bot-msg fade-in">${msg}</div>`;
    box.scrollTop = box.scrollHeight;
}

// RESTAURA O MENU PRINCIPAL
function voltarMenu() {
    opcoes.innerHTML = menuPrincipalHTML;
    addBot("Sem problemas. Selecione outra op√ß√£o abaixo:");
}

function finalizar(assunto){
    // ADICIONADO BOTAO DE VOLTAR AQUI
    opcoes.innerHTML = `
        <div class="row g-2">
            <div class="col-12">
                <p class="text-white text-center mb-2">Isso resolveu?</p>
            </div>
            <div class="col-4">
                <button class="btn btn-success w-100" onclick="registrarAutoResolucao('${assunto}')">‚úÖ Sim</button>
            </div>
            <div class="col-4">
                <button class="btn btn-danger w-100" onclick="mostrarFormulario('${assunto}')">‚ùå N√£o</button>
            </div>
            <div class="col-4">
                <button class="btn btn-secondary w-100" onclick="voltarMenu()">‚Ü©Ô∏è Voltar</button>
            </div>
        </div>
    `;
}

async function registrarAutoResolucao(assunto) {
    opcoes.innerHTML = `<div class="alert alert-success text-center">üéâ Que bom! O NTI agradece.</div>`;
    addBot("Fico feliz em ter ajudado! O caso foi registrado como solucionado.");
    
    try {
        await fetch('/api/ticket/auto', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ 
                solicitante: "Usu√°rio Web", 
                problema: `[${assunto}] Resolvido via Chatbot` 
            })
        });
    } catch (e) { console.error("Erro ao salvar log", e); }

    setTimeout(() => location.reload(), 4000);
}

function mostrarFormulario(assunto) {
    opcoes.classList.add('hidden');
    form.classList.remove('hidden');
    document.getElementById('assunto-pre').value = assunto;
    addBot(`Entendido. Por favor, preencha seus dados para que eu chame um t√©cnico para verificar o problema de: <strong>${assunto}</strong>.`);
}

function cancelar() {
    form.classList.add('hidden');
    opcoes.classList.remove('hidden');
    voltarMenu(); // Ao cancelar, restaura o menu completo
}

function conversa(tipo){
    let r = "";
    let assunto = "";

    // --- TEXTOS RESTAURADOS INTEGRALMENTE ---

    if(tipo === 'lento'){
        addUser("Computador est√° lento");
        assunto = "Computador Lento";
        r = `1) Feche programas que n√£o est√° utilizando.<br>
             2) Pressione Ctrl + Shift + Esc ‚Üí veja se h√° algo consumindo muita CPU ou Mem√≥ria.<br>
             3) Reinicie o computador.<br>
             4) Verifique se o Disco C: est√° quase cheio.<br>
             5) Se estiver lento ao iniciar, pode haver muitos programas na inicializa√ß√£o.<br><br>
             ‚ö†Ô∏è Se continuar lento, pode ser problema de HD, mem√≥ria RAM ou v√≠rus.`;
    }

    if(tipo === 'sistema'){
        addUser("Sistema institucional n√£o abre");
        assunto = "Sistema Institucional";
        r = `1) Verifique se a internet est√° funcionando.<br>
             2) Tente acessar outro site para confirmar conex√£o.<br>
             3) Pressione Ctrl + F5 para atualizar for√ßado.<br>
             4) Teste outro navegador.<br>
             5) Observe se aparece mensagem de erro espec√≠fica.<br><br>
             ‚ö†Ô∏è Pode ser instabilidade do servidor.`;
    }

    if(tipo === 'senha'){
        addUser("Problema com senha ou acesso");
        assunto = "Senha / Acesso";
        r = `1) Verifique se CAPS LOCK est√° ativado.<br>
             2) Confirme se est√° digitando usu√°rio correto.<br>
             3) Reinicie o computador e tente novamente.<br>
             4) Se bloqueado por tentativas, aguarde 15 minutos.<br><br>
             üîê Se persistir, ser√° necess√°rio reset de senha pelo NTI.`;
    }

    if(tipo === 'telaazul'){
        addUser("Apareceu tela azul");
        assunto = "Tela Azul";
        r = `1) Anote o c√≥digo do erro exibido.<br>
             2) Reinicie o computador.<br>
             3) Se ocorrer novamente, pode indicar:<br>
             - Problema de mem√≥ria RAM<br>
             - Driver incompat√≠vel<br>
             - HD com falha<br><br>
             ‚ö†Ô∏è Evite desligamentos for√ßados repetidos.`;
    }

    if(tipo === 'audio'){
        addUser("Computador est√° sem som");
        assunto = "√Åudio";
        r = `1) Verifique se o volume n√£o est√° no mudo.<br>
             2) Clique no √≠cone de som e selecione dispositivo correto.<br>
             3) Teste outro v√≠deo ou arquivo.<br>
             4) Reinicie o computador.<br>
             5) Se for headset USB, troque a porta.<br><br>
             üîä Pode ser driver de √°udio.`;
    }

    if(tipo === 'arquivo'){
        addUser("Arquivo n√£o abre");
        assunto = "Arquivo n√£o abre";
        r = `1) Verifique se possui o programa adequado instalado.<br>
             2) Tente abrir em outro computador.<br>
             3) Pode estar corrompido.<br>
             4) Verifique se o arquivo foi baixado completamente.<br><br>
             üìÑ Se necess√°rio, enviar c√≥pia para an√°lise.`;
    }

    if(tipo === 'desliga'){
        addUser("PC liga mas desliga sozinho");
        assunto = "Desligamento inesperado";
        r = `1) Verifique se h√° superaquecimento (ventoinhas funcionando?).<br>
             2) Teste outra tomada.<br>
             3) Verifique estabilizador/filtro de linha.<br>
             4) Pode ser fonte com defeito.<br><br>
             ‚ö†Ô∏è N√£o insista em ligar repetidamente.`;
    }

    if(tipo === 'internet'){
        addUser("Estou sem internet (cabo)");
        assunto = "Internet Cabeada";
        r = `1) Verifique se o cabo est√° conectado firmemente.<br>
             2) Veja se h√° luzes piscando na porta de rede (tr√°s do PC).<br>
             3) Reinicie o computador.<br>
             4) Se nada piscar, o cabo pode estar danificado.`;
    }

    if(tipo === 'wifi'){
        addUser("Wi-Fi n√£o conecta");
        assunto = "Wi-Fi";
        r = `1) Desligue e ligue o Wi-Fi do seu dispositivo.<br>
             2) Verifique se est√° na rede correta da institui√ß√£o.<br>
             3) Reinicie o computador.<br>
             4) "Esquecer" a rede e conectar novamente.`;
    }

    if(tipo === 'impressora'){
        addUser("Impressora n√£o imprime");
        assunto = "Impressora";
        r = `1) Verifique se h√° papel e se est√° ligada.<br>
             2) Confira o cabo USB.<br>
             3) Verifique se h√° luzes de erro piscando na impressora.<br>
             4) Reinicie o computador.`;
    }

    if(tipo === 'monitor'){
        addUser("Monitor n√£o liga / sem imagem");
        assunto = "Monitor";
        r = `1) Verifique a tomada e o cabo de for√ßa.<br>
             2) Aperte o bot√£o Power do monitor.<br>
             3) Verifique o cabo de v√≠deo (VGA/HDMI).<br>
             4) Teste em outra tomada.`;
    }

    if(tipo === 'periferico'){
        addUser("Mouse ou teclado ruim");
        assunto = "Perif√©ricos";
        r = `1) Troque de porta USB.<br>
             2) Se for sem fio, troque as pilhas.<br>
             3) Reinicie o computador.`;
    }

    if(tipo === 'energia'){
        addUser("PC n√£o liga");
        assunto = "Energia/El√©trica";
        r = `1) Verifique se o estabilizador/filtro est√° ligado.<br>
             2) Teste a tomada com outro aparelho (carregador celular).<br>
             3) Verifique os cabos de for√ßa atr√°s da CPU.`;
    }

    setTimeout(()=>{
        addBot(r);
        addBot("Isso ajudou?");
        finalizar(assunto);
    }, 400);
}

async function enviarChamado() {
    const nome = document.getElementById('nome').value;
    const matricula = document.getElementById('matricula').value;
    const setor = document.getElementById('setor').value;
    const assunto = document.getElementById('assunto-pre').value;
    const descExtra = document.getElementById('desc').value;

    if(!nome || !setor || !matricula) return alert('Por favor, preencha Nome, Matr√≠cula e Setor!');

    const problemaFinal = `[${assunto}] ${descExtra}`;

    try {
        const res = await fetch('/api/ticket', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ solicitante: nome, matricula: matricula, setor: setor, problema: problemaFinal })
        });

        if(res.ok) {
            form.classList.add('hidden');
            box.innerHTML += `
                <div class="bot-msg" style="background-color: #2ecc71;">
                    ‚úÖ <strong>Chamado Criado!</strong><br>
                    ID gerado. Em breve, um analista do NTI ir√° atend√™-lo(a).
                </div>
            `;
            box.scrollTop = box.scrollHeight;
            setTimeout(() => location.reload(), 5000);
        } else {
            alert('Erro ao comunicar com o servidor.');
        }
    } catch (e) {
        alert('Erro de conex√£o. Verifique se o servidor est√° rodando.');
        console.error(e);
    }
}
</script>

</body>
</html>